import c from"node:module";import{MessageChannel as f}from"node:worker_threads";import{pathToFileURL as d}from"node:url";const u=(r,t,e)=>{const o=t.startsWith("file://")?t:d(t),s=new URL(r,o);return s.searchParams.set("tsx-namespace",e),s.toString()},l=r=>(t,e)=>{if(!e)throw new Error("The current file path (import.meta.url) must be provided in the second argument of tsImport()");return import(u(t,e,r))},g=r=>{if(!c.register)throw new Error(`This version of Node.js (${process.version}) does not support module.register(). Please upgrade to Node v18.9 or v20.6 and above.`);const{sourceMapsEnabled:t}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:o}=new f;c.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{port:o,namespace:r?.namespace,tsconfig:r?.tsconfig},transferList:[o]});const s=r?.onImport,a=s&&(i=>{i.type==="load"&&s(i.url)});a&&(e.on("message",a),e.unref());const n=()=>(t===!1&&process.setSourceMapsEnabled(!1),a&&e.off("message",a),e.postMessage("deactivate"),new Promise(i=>{const p=m=>{m.type==="deactivated"&&(i(),e.off("message",p))};e.on("message",p)}));return r?.namespace&&(n.import=l(r.namespace),n.unregister=n),n};export{g as r};
